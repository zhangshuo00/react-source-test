{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\nimport { getInstanceFromNode, getFiberCurrentPropsFromNode } from '../client/ReactDOMComponentTree'; // Use to restore controlled state after a change event has fired.\n\nlet restoreImpl = null;\nlet restoreTarget = null;\nlet restoreQueue = null;\n\nfunction restoreStateOfTarget(target) {\n  // We perform this translation at the end of the event loop so that we\n  // always receive the correct fiber here\n  const internalInstance = getInstanceFromNode(target);\n\n  if (!internalInstance) {\n    // Unmounted\n    return;\n  }\n\n  if (typeof restoreImpl !== 'function') {\n    throw new Error('setRestoreImplementation() needs to be called to handle a target for controlled ' + 'events. This error is likely caused by a bug in React. Please file an issue.');\n  }\n\n  const stateNode = internalInstance.stateNode; // Guard against Fiber being unmounted.\n\n  if (stateNode) {\n    const props = getFiberCurrentPropsFromNode(stateNode);\n    restoreImpl(internalInstance.stateNode, internalInstance.type, props);\n  }\n}\n\nexport function setRestoreImplementation(impl) {\n  restoreImpl = impl;\n}\nexport function enqueueStateRestore(target) {\n  if (restoreTarget) {\n    if (restoreQueue) {\n      restoreQueue.push(target);\n    } else {\n      restoreQueue = [target];\n    }\n  } else {\n    restoreTarget = target;\n  }\n}\nexport function needsStateRestore() {\n  return restoreTarget !== null || restoreQueue !== null;\n}\nexport function restoreStateIfNeeded() {\n  if (!restoreTarget) {\n    return;\n  }\n\n  const target = restoreTarget;\n  const queuedTargets = restoreQueue;\n  restoreTarget = null;\n  restoreQueue = null;\n  restoreStateOfTarget(target);\n\n  if (queuedTargets) {\n    for (let i = 0; i < queuedTargets.length; i++) {\n      restoreStateOfTarget(queuedTargets[i]);\n    }\n  }\n}","map":{"version":3,"sources":["/Users/zhangshuo/git/react-source-test/src/react/packages/react-dom/src/events/ReactDOMControlledComponent.js"],"names":["getInstanceFromNode","getFiberCurrentPropsFromNode","restoreImpl","restoreTarget","restoreQueue","restoreStateOfTarget","target","internalInstance","Error","stateNode","props","type","setRestoreImplementation","impl","enqueueStateRestore","push","needsStateRestore","restoreStateIfNeeded","queuedTargets","i","length"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,SACEA,mBADF,EAEEC,4BAFF,QAGO,iCAHP,C,CAKA;;AAEA,IAAIC,WAAW,GAAG,IAAlB;AACA,IAAIC,aAAa,GAAG,IAApB;AACA,IAAIC,YAAY,GAAG,IAAnB;;AAEA,SAASC,oBAAT,CAA8BC,MAA9B,EAA4C;AAC1C;AACA;AACA,QAAMC,gBAAgB,GAAGP,mBAAmB,CAACM,MAAD,CAA5C;;AACA,MAAI,CAACC,gBAAL,EAAuB;AACrB;AACA;AACD;;AAED,MAAI,OAAOL,WAAP,KAAuB,UAA3B,EAAuC;AACrC,UAAM,IAAIM,KAAJ,CACJ,qFACE,8EAFE,CAAN;AAID;;AAED,QAAMC,SAAS,GAAGF,gBAAgB,CAACE,SAAnC,CAhB0C,CAiB1C;;AACA,MAAIA,SAAJ,EAAe;AACb,UAAMC,KAAK,GAAGT,4BAA4B,CAACQ,SAAD,CAA1C;AACAP,IAAAA,WAAW,CAACK,gBAAgB,CAACE,SAAlB,EAA6BF,gBAAgB,CAACI,IAA9C,EAAoDD,KAApD,CAAX;AACD;AACF;;AAED,OAAO,SAASE,wBAAT,CACLC,IADK,EAEC;AACNX,EAAAA,WAAW,GAAGW,IAAd;AACD;AAED,OAAO,SAASC,mBAAT,CAA6BR,MAA7B,EAAiD;AACtD,MAAIH,aAAJ,EAAmB;AACjB,QAAIC,YAAJ,EAAkB;AAChBA,MAAAA,YAAY,CAACW,IAAb,CAAkBT,MAAlB;AACD,KAFD,MAEO;AACLF,MAAAA,YAAY,GAAG,CAACE,MAAD,CAAf;AACD;AACF,GAND,MAMO;AACLH,IAAAA,aAAa,GAAGG,MAAhB;AACD;AACF;AAED,OAAO,SAASU,iBAAT,GAAsC;AAC3C,SAAOb,aAAa,KAAK,IAAlB,IAA0BC,YAAY,KAAK,IAAlD;AACD;AAED,OAAO,SAASa,oBAAT,GAAgC;AACrC,MAAI,CAACd,aAAL,EAAoB;AAClB;AACD;;AACD,QAAMG,MAAM,GAAGH,aAAf;AACA,QAAMe,aAAa,GAAGd,YAAtB;AACAD,EAAAA,aAAa,GAAG,IAAhB;AACAC,EAAAA,YAAY,GAAG,IAAf;AAEAC,EAAAA,oBAAoB,CAACC,MAAD,CAApB;;AACA,MAAIY,aAAJ,EAAmB;AACjB,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,aAAa,CAACE,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7Cd,MAAAA,oBAAoB,CAACa,aAAa,CAACC,CAAD,CAAd,CAApB;AACD;AACF;AACF","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport {\n  getInstanceFromNode,\n  getFiberCurrentPropsFromNode,\n} from '../client/ReactDOMComponentTree';\n\n// Use to restore controlled state after a change event has fired.\n\nlet restoreImpl = null;\nlet restoreTarget = null;\nlet restoreQueue = null;\n\nfunction restoreStateOfTarget(target: Node) {\n  // We perform this translation at the end of the event loop so that we\n  // always receive the correct fiber here\n  const internalInstance = getInstanceFromNode(target);\n  if (!internalInstance) {\n    // Unmounted\n    return;\n  }\n\n  if (typeof restoreImpl !== 'function') {\n    throw new Error(\n      'setRestoreImplementation() needs to be called to handle a target for controlled ' +\n        'events. This error is likely caused by a bug in React. Please file an issue.',\n    );\n  }\n\n  const stateNode = internalInstance.stateNode;\n  // Guard against Fiber being unmounted.\n  if (stateNode) {\n    const props = getFiberCurrentPropsFromNode(stateNode);\n    restoreImpl(internalInstance.stateNode, internalInstance.type, props);\n  }\n}\n\nexport function setRestoreImplementation(\n  impl: (domElement: Element, tag: string, props: Object) => void,\n): void {\n  restoreImpl = impl;\n}\n\nexport function enqueueStateRestore(target: Node): void {\n  if (restoreTarget) {\n    if (restoreQueue) {\n      restoreQueue.push(target);\n    } else {\n      restoreQueue = [target];\n    }\n  } else {\n    restoreTarget = target;\n  }\n}\n\nexport function needsStateRestore(): boolean {\n  return restoreTarget !== null || restoreQueue !== null;\n}\n\nexport function restoreStateIfNeeded() {\n  if (!restoreTarget) {\n    return;\n  }\n  const target = restoreTarget;\n  const queuedTargets = restoreQueue;\n  restoreTarget = null;\n  restoreQueue = null;\n\n  restoreStateOfTarget(target);\n  if (queuedTargets) {\n    for (let i = 0; i < queuedTargets.length; i++) {\n      restoreStateOfTarget(queuedTargets[i]);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}