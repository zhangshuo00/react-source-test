{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\nimport isArray from 'shared/isArray';\nimport { checkControlledValueProps } from '../shared/ReactControlledValuePropTypes';\nimport { getCurrentFiberOwnerNameInDevOrNull } from 'react-reconciler/src/ReactCurrentFiber';\nimport { getToStringValue, toString } from './ToStringValue';\nimport { disableTextareaChildren } from 'shared/ReactFeatureFlags';\nlet didWarnValDefaultVal = false;\n\n/**\n * Implements a <textarea> host component that allows setting `value`, and\n * `defaultValue`. This differs from the traditional DOM API because value is\n * usually set as PCDATA children.\n *\n * If `value` is not supplied (or null/undefined), user actions that affect the\n * value will trigger updates to the element.\n *\n * If `value` is supplied (and not null/undefined), the rendered element will\n * not trigger updates to the element. Instead, the `value` prop must change in\n * order for the rendered element to be updated.\n *\n * The rendered element will be initialized with an empty value, the prop\n * `defaultValue` if specified, or the children content (deprecated).\n */\nexport function getHostProps(element, props) {\n  const node = element;\n\n  if (props.dangerouslySetInnerHTML != null) {\n    throw new Error('`dangerouslySetInnerHTML` does not make sense on <textarea>.');\n  } // Always set children to the same thing. In IE9, the selection range will\n  // get reset if `textContent` is mutated.  We could add a check in setTextContent\n  // to only set the value if/when the value differs from the node value (which would\n  // completely solve this IE9 bug), but Sebastian+Sophie seemed to like this\n  // solution. The value can be a boolean or object so that's why it's forced\n  // to be a string.\n\n\n  const hostProps = { ...props,\n    value: undefined,\n    defaultValue: undefined,\n    children: toString(node._wrapperState.initialValue)\n  };\n  return hostProps;\n}\nexport function initWrapperState(element, props) {\n  const node = element;\n\n  if (__DEV__) {\n    checkControlledValueProps('textarea', props);\n\n    if (props.value !== undefined && props.defaultValue !== undefined && !didWarnValDefaultVal) {\n      console.error('%s contains a textarea with both value and defaultValue props. ' + 'Textarea elements must be either controlled or uncontrolled ' + '(specify either the value prop, or the defaultValue prop, but not ' + 'both). Decide between using a controlled or uncontrolled textarea ' + 'and remove one of these props. More info: ' + 'https://reactjs.org/link/controlled-components', getCurrentFiberOwnerNameInDevOrNull() || 'A component');\n      didWarnValDefaultVal = true;\n    }\n  }\n\n  let initialValue = props.value; // Only bother fetching default value if we're going to use it\n\n  if (initialValue == null) {\n    let {\n      children,\n      defaultValue\n    } = props;\n\n    if (children != null) {\n      if (__DEV__) {\n        console.error('Use the `defaultValue` or `value` props instead of setting ' + 'children on <textarea>.');\n      }\n\n      if (!disableTextareaChildren) {\n        if (defaultValue != null) {\n          throw new Error('If you supply `defaultValue` on a <textarea>, do not pass children.');\n        }\n\n        if (isArray(children)) {\n          if (children.length > 1) {\n            throw new Error('<textarea> can only have at most one child.');\n          }\n\n          children = children[0];\n        }\n\n        defaultValue = children;\n      }\n    }\n\n    if (defaultValue == null) {\n      defaultValue = '';\n    }\n\n    initialValue = defaultValue;\n  }\n\n  node._wrapperState = {\n    initialValue: getToStringValue(initialValue)\n  };\n}\nexport function updateWrapper(element, props) {\n  const node = element;\n  const value = getToStringValue(props.value);\n  const defaultValue = getToStringValue(props.defaultValue);\n\n  if (value != null) {\n    // Cast `value` to a string to ensure the value is set correctly. While\n    // browsers typically do this as necessary, jsdom doesn't.\n    const newValue = toString(value); // To avoid side effects (such as losing text selection), only set value if changed\n\n    if (newValue !== node.value) {\n      node.value = newValue;\n    }\n\n    if (props.defaultValue == null && node.defaultValue !== newValue) {\n      node.defaultValue = newValue;\n    }\n  }\n\n  if (defaultValue != null) {\n    node.defaultValue = toString(defaultValue);\n  }\n}\nexport function postMountWrapper(element, props) {\n  const node = element; // This is in postMount because we need access to the DOM node, which is not\n  // available until after the component has mounted.\n\n  const textContent = node.textContent; // Only set node.value if textContent is equal to the expected\n  // initial value. In IE10/IE11 there is a bug where the placeholder attribute\n  // will populate textContent as well.\n  // https://developer.microsoft.com/microsoft-edge/platform/issues/101525/\n\n  if (textContent === node._wrapperState.initialValue) {\n    if (textContent !== '' && textContent !== null) {\n      node.value = textContent;\n    }\n  }\n}\nexport function restoreControlledState(element, props) {\n  // DOM component is still mounted; update\n  updateWrapper(element, props);\n}","map":{"version":3,"sources":["/Users/zhangshuo/git/react-source-test/src/react/packages/react-dom/src/client/ReactDOMTextarea.js"],"names":["isArray","checkControlledValueProps","getCurrentFiberOwnerNameInDevOrNull","getToStringValue","toString","disableTextareaChildren","didWarnValDefaultVal","getHostProps","element","props","node","dangerouslySetInnerHTML","Error","hostProps","value","undefined","defaultValue","children","_wrapperState","initialValue","initWrapperState","__DEV__","console","error","length","updateWrapper","newValue","postMountWrapper","textContent","restoreControlledState"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport isArray from 'shared/isArray';\n\nimport {checkControlledValueProps} from '../shared/ReactControlledValuePropTypes';\nimport {getCurrentFiberOwnerNameInDevOrNull} from 'react-reconciler/src/ReactCurrentFiber';\nimport {getToStringValue, toString} from './ToStringValue';\nimport type {ToStringValue} from './ToStringValue';\nimport {disableTextareaChildren} from 'shared/ReactFeatureFlags';\n\nlet didWarnValDefaultVal = false;\n\ntype TextAreaWithWrapperState = HTMLTextAreaElement & {|\n  _wrapperState: {|initialValue: ToStringValue|},\n|};\n\n/**\n * Implements a <textarea> host component that allows setting `value`, and\n * `defaultValue`. This differs from the traditional DOM API because value is\n * usually set as PCDATA children.\n *\n * If `value` is not supplied (or null/undefined), user actions that affect the\n * value will trigger updates to the element.\n *\n * If `value` is supplied (and not null/undefined), the rendered element will\n * not trigger updates to the element. Instead, the `value` prop must change in\n * order for the rendered element to be updated.\n *\n * The rendered element will be initialized with an empty value, the prop\n * `defaultValue` if specified, or the children content (deprecated).\n */\n\nexport function getHostProps(element: Element, props: Object) {\n  const node = ((element: any): TextAreaWithWrapperState);\n\n  if (props.dangerouslySetInnerHTML != null) {\n    throw new Error(\n      '`dangerouslySetInnerHTML` does not make sense on <textarea>.',\n    );\n  }\n\n  // Always set children to the same thing. In IE9, the selection range will\n  // get reset if `textContent` is mutated.  We could add a check in setTextContent\n  // to only set the value if/when the value differs from the node value (which would\n  // completely solve this IE9 bug), but Sebastian+Sophie seemed to like this\n  // solution. The value can be a boolean or object so that's why it's forced\n  // to be a string.\n  const hostProps = {\n    ...props,\n    value: undefined,\n    defaultValue: undefined,\n    children: toString(node._wrapperState.initialValue),\n  };\n\n  return hostProps;\n}\n\nexport function initWrapperState(element: Element, props: Object) {\n  const node = ((element: any): TextAreaWithWrapperState);\n  if (__DEV__) {\n    checkControlledValueProps('textarea', props);\n    if (\n      props.value !== undefined &&\n      props.defaultValue !== undefined &&\n      !didWarnValDefaultVal\n    ) {\n      console.error(\n        '%s contains a textarea with both value and defaultValue props. ' +\n          'Textarea elements must be either controlled or uncontrolled ' +\n          '(specify either the value prop, or the defaultValue prop, but not ' +\n          'both). Decide between using a controlled or uncontrolled textarea ' +\n          'and remove one of these props. More info: ' +\n          'https://reactjs.org/link/controlled-components',\n        getCurrentFiberOwnerNameInDevOrNull() || 'A component',\n      );\n      didWarnValDefaultVal = true;\n    }\n  }\n\n  let initialValue = props.value;\n\n  // Only bother fetching default value if we're going to use it\n  if (initialValue == null) {\n    let {children, defaultValue} = props;\n    if (children != null) {\n      if (__DEV__) {\n        console.error(\n          'Use the `defaultValue` or `value` props instead of setting ' +\n            'children on <textarea>.',\n        );\n      }\n      if (!disableTextareaChildren) {\n        if (defaultValue != null) {\n          throw new Error(\n            'If you supply `defaultValue` on a <textarea>, do not pass children.',\n          );\n        }\n\n        if (isArray(children)) {\n          if (children.length > 1) {\n            throw new Error('<textarea> can only have at most one child.');\n          }\n\n          children = children[0];\n        }\n\n        defaultValue = children;\n      }\n    }\n    if (defaultValue == null) {\n      defaultValue = '';\n    }\n    initialValue = defaultValue;\n  }\n\n  node._wrapperState = {\n    initialValue: getToStringValue(initialValue),\n  };\n}\n\nexport function updateWrapper(element: Element, props: Object) {\n  const node = ((element: any): TextAreaWithWrapperState);\n  const value = getToStringValue(props.value);\n  const defaultValue = getToStringValue(props.defaultValue);\n  if (value != null) {\n    // Cast `value` to a string to ensure the value is set correctly. While\n    // browsers typically do this as necessary, jsdom doesn't.\n    const newValue = toString(value);\n    // To avoid side effects (such as losing text selection), only set value if changed\n    if (newValue !== node.value) {\n      node.value = newValue;\n    }\n    if (props.defaultValue == null && node.defaultValue !== newValue) {\n      node.defaultValue = newValue;\n    }\n  }\n  if (defaultValue != null) {\n    node.defaultValue = toString(defaultValue);\n  }\n}\n\nexport function postMountWrapper(element: Element, props: Object) {\n  const node = ((element: any): TextAreaWithWrapperState);\n  // This is in postMount because we need access to the DOM node, which is not\n  // available until after the component has mounted.\n  const textContent = node.textContent;\n\n  // Only set node.value if textContent is equal to the expected\n  // initial value. In IE10/IE11 there is a bug where the placeholder attribute\n  // will populate textContent as well.\n  // https://developer.microsoft.com/microsoft-edge/platform/issues/101525/\n  if (textContent === node._wrapperState.initialValue) {\n    if (textContent !== '' && textContent !== null) {\n      node.value = textContent;\n    }\n  }\n}\n\nexport function restoreControlledState(element: Element, props: Object) {\n  // DOM component is still mounted; update\n  updateWrapper(element, props);\n}\n"]},"metadata":{},"sourceType":"module"}