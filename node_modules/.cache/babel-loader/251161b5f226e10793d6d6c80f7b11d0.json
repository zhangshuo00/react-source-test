{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\n// TODO: direct imports like some-package/src/* are bad. Fix me.\nimport { getCurrentFiberOwnerNameInDevOrNull } from 'react-reconciler/src/ReactCurrentFiber';\nimport { checkControlledValueProps } from '../shared/ReactControlledValuePropTypes';\nimport { getToStringValue, toString } from './ToStringValue';\nimport isArray from 'shared/isArray';\nlet didWarnValueDefaultValue;\n\nif (__DEV__) {\n  didWarnValueDefaultValue = false;\n}\n\nfunction getDeclarationErrorAddendum() {\n  const ownerName = getCurrentFiberOwnerNameInDevOrNull();\n\n  if (ownerName) {\n    return '\\n\\nCheck the render method of `' + ownerName + '`.';\n  }\n\n  return '';\n}\n\nconst valuePropNames = ['value', 'defaultValue'];\n/**\n * Validation function for `value` and `defaultValue`.\n */\n\nfunction checkSelectPropTypes(props) {\n  if (__DEV__) {\n    checkControlledValueProps('select', props);\n\n    for (let i = 0; i < valuePropNames.length; i++) {\n      const propName = valuePropNames[i];\n\n      if (props[propName] == null) {\n        continue;\n      }\n\n      const propNameIsArray = isArray(props[propName]);\n\n      if (props.multiple && !propNameIsArray) {\n        console.error('The `%s` prop supplied to <select> must be an array if ' + '`multiple` is true.%s', propName, getDeclarationErrorAddendum());\n      } else if (!props.multiple && propNameIsArray) {\n        console.error('The `%s` prop supplied to <select> must be a scalar ' + 'value if `multiple` is false.%s', propName, getDeclarationErrorAddendum());\n      }\n    }\n  }\n}\n\nfunction updateOptions(node, multiple, propValue, setDefaultSelected) {\n  const options = node.options;\n\n  if (multiple) {\n    const selectedValues = propValue;\n    const selectedValue = {};\n\n    for (let i = 0; i < selectedValues.length; i++) {\n      // Prefix to avoid chaos with special keys.\n      selectedValue['$' + selectedValues[i]] = true;\n    }\n\n    for (let i = 0; i < options.length; i++) {\n      const selected = selectedValue.hasOwnProperty('$' + options[i].value);\n\n      if (options[i].selected !== selected) {\n        options[i].selected = selected;\n      }\n\n      if (selected && setDefaultSelected) {\n        options[i].defaultSelected = true;\n      }\n    }\n  } else {\n    // Do not set `select.value` as exact behavior isn't consistent across all\n    // browsers for all cases.\n    const selectedValue = toString(getToStringValue(propValue));\n    let defaultSelected = null;\n\n    for (let i = 0; i < options.length; i++) {\n      if (options[i].value === selectedValue) {\n        options[i].selected = true;\n\n        if (setDefaultSelected) {\n          options[i].defaultSelected = true;\n        }\n\n        return;\n      }\n\n      if (defaultSelected === null && !options[i].disabled) {\n        defaultSelected = options[i];\n      }\n    }\n\n    if (defaultSelected !== null) {\n      defaultSelected.selected = true;\n    }\n  }\n}\n/**\n * Implements a <select> host component that allows optionally setting the\n * props `value` and `defaultValue`. If `multiple` is false, the prop must be a\n * stringable. If `multiple` is true, the prop must be an array of stringables.\n *\n * If `value` is not supplied (or null/undefined), user actions that change the\n * selected option will trigger updates to the rendered options.\n *\n * If it is supplied (and not null/undefined), the rendered options will not\n * update in response to user actions. Instead, the `value` prop must change in\n * order for the rendered options to update.\n *\n * If `defaultValue` is provided, any options with the supplied values will be\n * selected.\n */\n\n\nexport function getHostProps(element, props) {\n  return Object.assign({}, props, {\n    value: undefined\n  });\n}\nexport function initWrapperState(element, props) {\n  const node = element;\n\n  if (__DEV__) {\n    checkSelectPropTypes(props);\n  }\n\n  node._wrapperState = {\n    wasMultiple: !!props.multiple\n  };\n\n  if (__DEV__) {\n    if (props.value !== undefined && props.defaultValue !== undefined && !didWarnValueDefaultValue) {\n      console.error('Select elements must be either controlled or uncontrolled ' + '(specify either the value prop, or the defaultValue prop, but not ' + 'both). Decide between using a controlled or uncontrolled select ' + 'element and remove one of these props. More info: ' + 'https://reactjs.org/link/controlled-components');\n      didWarnValueDefaultValue = true;\n    }\n  }\n}\nexport function postMountWrapper(element, props) {\n  const node = element;\n  node.multiple = !!props.multiple;\n  const value = props.value;\n\n  if (value != null) {\n    updateOptions(node, !!props.multiple, value, false);\n  } else if (props.defaultValue != null) {\n    updateOptions(node, !!props.multiple, props.defaultValue, true);\n  }\n}\nexport function postUpdateWrapper(element, props) {\n  const node = element;\n  const wasMultiple = node._wrapperState.wasMultiple;\n  node._wrapperState.wasMultiple = !!props.multiple;\n  const value = props.value;\n\n  if (value != null) {\n    updateOptions(node, !!props.multiple, value, false);\n  } else if (wasMultiple !== !!props.multiple) {\n    // For simplicity, reapply `defaultValue` if `multiple` is toggled.\n    if (props.defaultValue != null) {\n      updateOptions(node, !!props.multiple, props.defaultValue, true);\n    } else {\n      // Revert the select back to its default unselected state.\n      updateOptions(node, !!props.multiple, props.multiple ? [] : '', false);\n    }\n  }\n}\nexport function restoreControlledState(element, props) {\n  const node = element;\n  const value = props.value;\n\n  if (value != null) {\n    updateOptions(node, !!props.multiple, value, false);\n  }\n}","map":{"version":3,"sources":["/Users/zhangshuo/git/react-source-test/src/react/packages/react-dom/src/client/ReactDOMSelect.js"],"names":["getCurrentFiberOwnerNameInDevOrNull","checkControlledValueProps","getToStringValue","toString","isArray","didWarnValueDefaultValue","__DEV__","getDeclarationErrorAddendum","ownerName","valuePropNames","checkSelectPropTypes","props","i","length","propName","propNameIsArray","multiple","console","error","updateOptions","node","propValue","setDefaultSelected","options","selectedValues","selectedValue","selected","hasOwnProperty","value","defaultSelected","disabled","getHostProps","element","Object","assign","undefined","initWrapperState","_wrapperState","wasMultiple","defaultValue","postMountWrapper","postUpdateWrapper","restoreControlledState"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n// TODO: direct imports like some-package/src/* are bad. Fix me.\nimport {getCurrentFiberOwnerNameInDevOrNull} from 'react-reconciler/src/ReactCurrentFiber';\n\nimport {checkControlledValueProps} from '../shared/ReactControlledValuePropTypes';\nimport {getToStringValue, toString} from './ToStringValue';\nimport isArray from 'shared/isArray';\n\nlet didWarnValueDefaultValue;\n\nif (__DEV__) {\n  didWarnValueDefaultValue = false;\n}\n\ntype SelectWithWrapperState = HTMLSelectElement & {|\n  _wrapperState: {|wasMultiple: boolean|},\n|};\n\nfunction getDeclarationErrorAddendum() {\n  const ownerName = getCurrentFiberOwnerNameInDevOrNull();\n  if (ownerName) {\n    return '\\n\\nCheck the render method of `' + ownerName + '`.';\n  }\n  return '';\n}\n\nconst valuePropNames = ['value', 'defaultValue'];\n\n/**\n * Validation function for `value` and `defaultValue`.\n */\nfunction checkSelectPropTypes(props) {\n  if (__DEV__) {\n    checkControlledValueProps('select', props);\n\n    for (let i = 0; i < valuePropNames.length; i++) {\n      const propName = valuePropNames[i];\n      if (props[propName] == null) {\n        continue;\n      }\n      const propNameIsArray = isArray(props[propName]);\n      if (props.multiple && !propNameIsArray) {\n        console.error(\n          'The `%s` prop supplied to <select> must be an array if ' +\n            '`multiple` is true.%s',\n          propName,\n          getDeclarationErrorAddendum(),\n        );\n      } else if (!props.multiple && propNameIsArray) {\n        console.error(\n          'The `%s` prop supplied to <select> must be a scalar ' +\n            'value if `multiple` is false.%s',\n          propName,\n          getDeclarationErrorAddendum(),\n        );\n      }\n    }\n  }\n}\n\nfunction updateOptions(\n  node: HTMLSelectElement,\n  multiple: boolean,\n  propValue: any,\n  setDefaultSelected: boolean,\n) {\n  type IndexableHTMLOptionsCollection = HTMLOptionsCollection & {\n    [key: number]: HTMLOptionElement,\n    ...,\n  };\n  const options: IndexableHTMLOptionsCollection = node.options;\n\n  if (multiple) {\n    const selectedValues = (propValue: Array<string>);\n    const selectedValue = {};\n    for (let i = 0; i < selectedValues.length; i++) {\n      // Prefix to avoid chaos with special keys.\n      selectedValue['$' + selectedValues[i]] = true;\n    }\n    for (let i = 0; i < options.length; i++) {\n      const selected = selectedValue.hasOwnProperty('$' + options[i].value);\n      if (options[i].selected !== selected) {\n        options[i].selected = selected;\n      }\n      if (selected && setDefaultSelected) {\n        options[i].defaultSelected = true;\n      }\n    }\n  } else {\n    // Do not set `select.value` as exact behavior isn't consistent across all\n    // browsers for all cases.\n    const selectedValue = toString(getToStringValue((propValue: any)));\n    let defaultSelected = null;\n    for (let i = 0; i < options.length; i++) {\n      if (options[i].value === selectedValue) {\n        options[i].selected = true;\n        if (setDefaultSelected) {\n          options[i].defaultSelected = true;\n        }\n        return;\n      }\n      if (defaultSelected === null && !options[i].disabled) {\n        defaultSelected = options[i];\n      }\n    }\n    if (defaultSelected !== null) {\n      defaultSelected.selected = true;\n    }\n  }\n}\n\n/**\n * Implements a <select> host component that allows optionally setting the\n * props `value` and `defaultValue`. If `multiple` is false, the prop must be a\n * stringable. If `multiple` is true, the prop must be an array of stringables.\n *\n * If `value` is not supplied (or null/undefined), user actions that change the\n * selected option will trigger updates to the rendered options.\n *\n * If it is supplied (and not null/undefined), the rendered options will not\n * update in response to user actions. Instead, the `value` prop must change in\n * order for the rendered options to update.\n *\n * If `defaultValue` is provided, any options with the supplied values will be\n * selected.\n */\n\nexport function getHostProps(element: Element, props: Object) {\n  return Object.assign({}, props, {\n    value: undefined,\n  });\n}\n\nexport function initWrapperState(element: Element, props: Object) {\n  const node = ((element: any): SelectWithWrapperState);\n  if (__DEV__) {\n    checkSelectPropTypes(props);\n  }\n\n  node._wrapperState = {\n    wasMultiple: !!props.multiple,\n  };\n\n  if (__DEV__) {\n    if (\n      props.value !== undefined &&\n      props.defaultValue !== undefined &&\n      !didWarnValueDefaultValue\n    ) {\n      console.error(\n        'Select elements must be either controlled or uncontrolled ' +\n          '(specify either the value prop, or the defaultValue prop, but not ' +\n          'both). Decide between using a controlled or uncontrolled select ' +\n          'element and remove one of these props. More info: ' +\n          'https://reactjs.org/link/controlled-components',\n      );\n      didWarnValueDefaultValue = true;\n    }\n  }\n}\n\nexport function postMountWrapper(element: Element, props: Object) {\n  const node = ((element: any): SelectWithWrapperState);\n  node.multiple = !!props.multiple;\n  const value = props.value;\n  if (value != null) {\n    updateOptions(node, !!props.multiple, value, false);\n  } else if (props.defaultValue != null) {\n    updateOptions(node, !!props.multiple, props.defaultValue, true);\n  }\n}\n\nexport function postUpdateWrapper(element: Element, props: Object) {\n  const node = ((element: any): SelectWithWrapperState);\n  const wasMultiple = node._wrapperState.wasMultiple;\n  node._wrapperState.wasMultiple = !!props.multiple;\n\n  const value = props.value;\n  if (value != null) {\n    updateOptions(node, !!props.multiple, value, false);\n  } else if (wasMultiple !== !!props.multiple) {\n    // For simplicity, reapply `defaultValue` if `multiple` is toggled.\n    if (props.defaultValue != null) {\n      updateOptions(node, !!props.multiple, props.defaultValue, true);\n    } else {\n      // Revert the select back to its default unselected state.\n      updateOptions(node, !!props.multiple, props.multiple ? [] : '', false);\n    }\n  }\n}\n\nexport function restoreControlledState(element: Element, props: Object) {\n  const node = ((element: any): SelectWithWrapperState);\n  const value = props.value;\n\n  if (value != null) {\n    updateOptions(node, !!props.multiple, value, false);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}